# lee un CSV, filtra score>=80, ordena por date DESC y saca top 5 como "name,score"
from __future__ import annotations
from pathlib import Path
import csv
from datetime import date

def parse_date(s: str) -> date:
    # YYYY-MM-DD
    y, m, d = s.split("-")
    return date(int(y), int(m), int(d))

def main(root: str) -> None:
    p = Path(root) / "datos.csv"
    rows = []
    with p.open("r", encoding="utf-8-sig", newline="") as f:
        rdr = csv.DictReader(f)
        for r in rdr:
            try:
                sc = int(r["score"])
                if sc >= 80:
                    rows.append((r["name"], sc, parse_date(r["date"])))
            except Exception:
                pass

    # ordena por fecha descendente
    rows.sort(key=lambda t: t[2], reverse=True)
    # imprime top 5
    for name, sc, _dt in rows[:5]:
        print(f"{name},{sc}")

if __name__ == "__main__":
    import sys
    root = sys.argv[1] if len(sys.argv) > 1 else "."
    main(root)
